/*! http://www.zkea.net/
 * Copyright (c) ZKEASOFT. All rights reserved.
 * http://www.zkea.net/licenses */
$(function(){function c(n){$("input.select-image",n).popover({trigger:"focus",html:!0,title:"图片预览",content:function(){var n=$(this).val();return n?(n.indexOf("~")===0&&(n=n.replace("~",location.origin)),'<div style="width:244px;"><img class="opacity-dotted" src="'+n+'"/><\/div>'):null},placement:"bottom"}).trigger("change").parent().addClass("loading")}var t,i,f,r,s,h,p;$(".accordion-group>a").click(function(){var t="active",n=$(this),i=n.nextAll(".accordion-inner");return n.hasClass(t)?(n.removeClass(t),i.hide(200)):(n.addClass(t),i.show(200)),!1});$(document).on("click",".cancel",function(){window.history.back()}).on("click",".publish",function(){return confirm("确认要发布吗？")?!0:!1}).on("click","input[type=submit]",function(){return $("#ActionType").val($(this).data("value")),!0}).on("click",".input-group .search",function(){var n=$(this);window.top.Easy.ShowUrlWindow({url:n.parent().siblings("input.form-control").data("url"),width:n.parent().siblings("input.form-control").data("width")||window.innerWidth*.9,onLoad:function(t){var i=this;$(this.document).find("#confirm").click(function(){var u=n.parent().siblings("input.form-control"),r=i.GetSelected(),o,f,e,s;if(typeof r=="object"){if(u.val(r.value),r.additional){o=u.closest("form");f=u.attr("name").split(".");for(e in r.additional)r.additional.hasOwnProperty(e)&&(f[f.length-1]=e,s=f.join("."),$('[name="'+s+'"]',o).val(r.additional[e]))}}else u.val(r);t.close();u.trigger("change")});$(this.document).on("click",".confirm",function(){var i=n.parent().siblings("input.form-control");i.val($(this).data("result"));t.close();i.trigger("change")})}})}).on("click",".form-group select#ZoneId",function(){var t=$(this),n,i,r;t.val()!="ZONE-X"&&(n=new URL("/admin/Layout/SelectZone",document.baseURI),i=$(".hide #LayoutId").val(),i&&n.searchParams.append("layoutId",i),r=$(".hide #PageId").val(),r&&n.searchParams.append("pageId",r),n.searchParams.append("zoneId",t.val()),window.top.Easy.ShowUrlWindow({url:n.toString(),width:1e3,title:"选择区域",onLoad:function(n){var i=this;$(this.document).find("#confirm").click(function(){t.val(i.GetSelected());n.close()})}}))}).on("click",".custom-style-editor",function(){window.top.Easy.ShowUrlWindow({url:"/admin/StyleEditor/Edit",width:1024,title:"编辑样式",onLoad:function(n){n.addClass("loaded")},isDialog:!1});$(".WeiWindow.BoxShadow").addClass("StyleEditor")}).on("click",".form-group select.select",function(){var n=$(this);window.top.Easy.ShowUrlWindow({url:n.data("url")+"?selected="+n.val(),width:n.data("width")||800,onLoad:function(t){var i=this;$(this.document).find("#confirm").click(function(){n.val(i.GetSelected());t.close();n.trigger("change")});$(this.document).on("click",".confirm",function(){n.val($(this).data("result"));t.close();n.trigger("change")})}})}).on("submit","form",function(){Easy.Block()});$(".form-group select#ZoneId,.form-group select.select").on("mousedown",!1);$(".form-group select#ZoneId").each(function(){$(this).val()=="ZONE-X"&&$(this).closest(".form-group").hide()});$.fn.datetimepicker&&$(".Date:not(input[type=hidden])").each(function(){$(this).prop("readonly")||$(this).prop("disabled")||($(this).datetimepicker({locale:"zh-CN",format:$(this).attr("JsDateFormat")}),$(this).closest(".input-group").find(".glyphicon-calendar").click(function(){$(this).closest(".input-group").find("input").focus()}))});$(document).on("click",".nav.nav-tabs a",function(){return $(this).tab("show"),!1});$(".nav.nav-tabs").each(function(){var n=!1;$("li",this).each(function(){$(this).hasClass("active")&&($(this).removeClass("active"),$("a",this).tab("show"),n=!0)});n||($("li:first a",this).tab("show"),location.hash&&$("li a[href='"+location.hash+"']",this).tab("show"))});$("#StyleClass.form-control").popover({trigger:"focus",html:!0,title:"自定义样式用法",content:function(){for(var t=[{name:"边框",value:"border"},{name:"文字居中",value:"align-center"},{name:"文字右对齐",value:"align-right"},{name:"图片边框",value:"image-border"},{name:"阴影",value:"box-shadow"},{name:"图片圆形",value:"image-circle"},{name:"取消外边距",value:"full"},{name:"居中容器",value:"container"}],i="<p clss='text-nowrap'>直接写样式例：<code>style=\"color:#fff\"<\/code><\/p><p>预定义样式：<ol>",n=0;n<t.length;n++)i+="<li>"+t[n].name+":<code>"+t[n].value+"<\/code><\/li>";return i+"<\/ol><\/p>"},placement:"bottom"});$(document).on("change","input.select-image",function(){var n=$(this).val();n&&n.indexOf("~/")!=0&&n.indexOf("/")!=0&&n.replace("http://","").replace("https://","").indexOf(window.location.hostname)!=0?$(this).siblings(".image-local").length==0&&$('<div class="input-group-addon image-local"><span class="glyphicon glyphicon-floppy-open upload-external"><\/span><\/div>').insertAfter($(this)):$(this).siblings(".image-local").remove()});$(document).on("list.added",function(n){c(n.target)});c(document);$(document).on("click",".image-local .upload-external",function(){var n=$(this).closest(".input-group");n.addClass("processing");$.post("/admin/Media/DownLoadExternalImage",{images:[n.find("input").val()]},function(t){if(t)for(var i=0;i<t.length;i++)n.find("input").val(t[i].value).trigger("change");n.removeClass("processing")},"json")});if(document.addEventListener){function l(n,t,i,r){var o="/admin/media/upload",f,e,u;i>0&&(o="/admin/media/appendfile");f=i+1e6;f>t.size&&(f=t.size);n.parentNode.classList.add("processing");n.value="...";e=new XMLHttpRequest;e.open("POST",o);e.onload=f==t.size?function(t){n.parentNode.classList.remove("processing");var i=JSON.parse(t.target.response);i.id&&(n.value="~"+i.url,$(n).blur().focus())}:function(i){var r=JSON.parse(i.target.response);r&&l(n,t,f,r)};e.onerror=function(){n.parentNode.classList.remove("processing");n.value="Error!"};u=new FormData;u.append("file",t.slice(i,f),t.name);u.append("folder","Images");u.append("size",t.size);r&&(u.append("id",r.id),u.append("position",i));e.send(u)}document.addEventListener("paste",function(n){var r,t,i,u;if(n.target.className&&n.target.className.indexOf("select-image")>=0&&(r=n.target,n.clipboardData?t=n.clipboardData:window.clipboardData&&(t=window.clipboardData),t&&t.items))for(i=0;i<t.items.length;i++)if(t.items[i].type.indexOf("image")!==-1){u=t.items[i].getAsFile();l(r,u,0);break}})}$(document).on("click",".input-group .video-play-icon",function(){var n=$(this).closest(".input-group").find(".form-control").val();n&&(n.indexOf("~")===0&&(n=n.replace("~",location.origin)),Easy.PlayVideo(n))});if(t=$("#main-menu"),t.length>0){var n,a=0,v=(location.pathname+location.search).split(/[/|?]/),u=$("a.menu-item",t);for(i=0;i<u.length;i++)if(f=$(u[i]).attr("href"),f){var w=f.toLowerCase().split(/[/|?]/),e=0,o=!0;for(r=0;r<v.length;r++)w.indexOf(v[r].toLowerCase())>=0?e++:o=!1;if((o||e>a)&&(a=e,n=$(u[i]),o))break}n&&n.size()&&(n.addClass("active"),n.parent().hasClass("accordion-inner")&&(n.parent().show(),n.parent().prev().addClass("active")));s=$(".menu-item.active",t).offset().top-t.offset().top;h=document.querySelector("#left-menu");function y(){h.style.height=window.innerHeight-133+"px"}y();p=window.Scrollbar.init(h);$(window).on("resize",function(){Easy.Processor(y,500)});s>0&&(p.scrollTop=s/2)}$.fn.select2&&$("select[multiple='multiple']").select2();$(".dy-editor:visible").trigger("init-editor")});